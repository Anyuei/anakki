<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description"
          content="anakki站">
    <meta name="anakki" content="x">
    <title>Anakki-World</title>
    <!-- Fonts -->

    <!-- Theme CSS -->
    <link type="text/css" href="assets/css/theme.css" rel="stylesheet">
    <!-- Demo CSS - No need to use these in your project -->
    <link type="text/css" href="assets/css/demo.css" rel="stylesheet">
    <!--    icon-->
    <!--    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">-->
    <!--    <link rel="stylesheet" href="https://cdn.staticfile.org/bootstrap-icons/1.10.0/bootstrap-icons.min.css">-->
</head>
<style>

    .btn-primary {
        color: #fff;
        background: #07070700;
        border-color: #fff0;
        box-shadow: none;
    }
    .modal {
        display: none;
        height: auto;
        top: 0px;
        position: fixed;
        right: 0px;
        width: 100%;
        vertical-align: middle;
        z-index: 9999;
        background-color: rgba(0, 0, 0, 0);
    }

    .modal-image {
        display: block;
        max-width: 90%;
        max-height: 95vh;
        margin: auto;
        margin-top: 5%;
    }

    .windows-bottom {
        position: fixed;
        right: 0px;
        bottom: 0px;
        background: #000;
        color: #fff;
        display: block;
        width: 100%;
        text-align: left;
        filter: alpha(opacity=70); /* IE */
        opacity: .7; /* 支持CSS3的浏览器（FF 1.5也支持）*/
        font-weight: bold;
    }

    body {
        background-color: #000000d4;
    }

    .figure-caption {
        font-size: 60%;
        color: #6c757d;
    }

    small, .small {
        font-size: 60%;
        font-weight: 400;
    }

    .row {
        display: flex;
        flex-wrap: wrap;
        margin-right: 0px;
        margin-left: 0px;
        margin-top: 0.5rem;
    }

    #mainFlow{
        -webkit-column-width:20rem; /*Safari and Chrome*/
        -moz-column-width:20rem; /*Firefox*/
        -o-column-width:20rem; /*Opera*/
        -ms-column-width:20rem; /*IE*/
        column-width:20rem;
        padding-right: 0px;
        padding-left: 0px;
    }
    #mainFlow > div{
        width: 100%; /*宽度根据实际情况调节，应与上面一致*/
        overflow:auto; /*防止内容溢出导致布局错位*/
    }

    p {
        margin-top: 0;
        margin-bottom: 0;
    }
    .loadDataBtn{
        opacity: 1.05;
        background-color: #7fffd400;
        width: 3rem;
        color: #c4c4c4;
        transition: transform 0.3s ease-in-out;
    }
    .loadDataBtn:hover {
        transform: scale(1.1);
    }

    #scrollReminder {
        position: fixed;
        bottom: 20px;
        transform: translateX(-50%); /* Center the icon horizontally */
        left: 50%; /* Set left position to 50% */
        transition: opacity 1s;
    }

    .hidden {
        opacity: 0;
    }
</style>
<body>
<!--通用顶部导航-->
<div id="header"></div>
<main class="main">
    <section class="spotlight parallax bg-cover bg-size--cover" data-spotlight="fullscreen"
             style="background-image: url('https://securex-1258150206.cos.ap-beijing.myqcloud.com/backend/DSC06473.jpg')">
        <div class="spotlight-holder pt-lg-xl py-lg-xl" style="min-height: 50rem;">
            <div class="container-fluid d-flex align-items-top no-padding">
                <div class="col">
                    <div class="row cols-xs-space align-items-center text-center text-md-left justify-content-center">
                        <div class="col-7">
                            <div class="text-center mt-5">
                                    <img src="assets/images/brand/icon.png" style="width: 20%;" class="img-fluid animated"
                                         data-animation-in="jackInTheBox" data-animation-delay="1000">

                                <h2 class="heading font-weight-400 text-white mt-5 animated"
                                    data-animation-in="fadeInUp" data-animation-delay="2000">
                                    <span class="font-weight-700">ANAKKI</span> X
                                </h2>
                                <span class="font-weight-200" style="color: #bdcbdb">封面摄于2022年站长川藏线骑行-新都桥段</span>
                                <p class="lead text-white mt-3 lh-180 c-white animated" data-animation-in="fadeInUp"
                                   data-animation-delay="2500">
                                    <strong class="text-white">

                                    </strong>
                                </p>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="scrollReminder">
                <svg style="color: white;" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-chevron-double-up" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M7.646 2.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 3.707 2.354 9.354a.5.5 0 1 1-.708-.708l6-6z"/>
                    <path fill-rule="evenodd" d="M7.646 6.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 7.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z"/>
                </svg>
            </div>
        </div>
    </section>

    <hr>
    <section class="slice">
        <div class="row justify-content-center">
            <div class="col-12" style="padding-right: 0px; padding-left: 0px;">
                <div class="row align-items-center mb-3">
                    <div class="col-6">
                        <h3 id="mainPageHead" class="heading h3 mb-0" style="color: #226a3e;">和光同尘，与时舒卷</h3>
                    </div>
                    <div class="col-6  text-right">
                        <h3 class="heading h3 mb-0">摄影集</h3>
                    </div>
                </div>
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-12" style="padding-right: 0px; padding-left: 0px;">
                <div class="row  align-items-center mb-5" >
                    <div class="col-12 col-offset-1" id="mainFlow">
                        <!--主要图文-->
                    </div>
                </div>
                <!--半透明的加载按钮-->
                <div class="row justify-content-center">
                    <div class="col-12 text-center">
                        <button id="loadMoreButton" class="btn loadDataBtn" >
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-double-down" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M1.646 6.646a.5.5 0 0 1 .708 0L8 12.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                                <path fill-rule="evenodd" d="M1.646 2.646a.5.5 0 0 1 .708 0L8 8.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>
<!-- 页面底部 -->
<div id="footer"></div>
<!-- Core -->
<script src="assets/vendor/jquery/jquery.min.js"></script>
<script src="assets/vendor/popper/popper.min.js"></script>
<script src="assets/js/bootstrap/bootstrap.min.js"></script>
<!-- FontAwesome 5 -->
<script src="assets/vendor/fontawesome/js/fontawesome-all.min.js" defer></script>
<!-- Page plugins -->
<script src="assets/vendor/bootstrap-select/js/bootstrap-select.min.js"></script>
<script src="assets/vendor/bootstrap-tagsinput/bootstrap-tagsinput.min.js"></script>
<script src="assets/vendor/input-mask/input-mask.min.js"></script>
<script src="assets/vendor/nouislider/js/nouislider.min.js"></script>
<script src="assets/vendor/textarea-autosize/textarea-autosize.min.js"></script>

<!-- Theme JS -->
<script src="assets/js/theme.js"></script>
<script>
    let currentPage=1;
    let size=10;
    let loading = false;
    let lastPage = false;
    window.onload = function () {
        $('#header').load("../pages/header.html", loadPersonDetail);
        $('#footer').load("../pages/footer.html", insertCreateTime);
        localImgData(currentPage);
        mainPageHead();
        window.addEventListener('scroll', function() {
            const scrollReminder = document.getElementById('scrollReminder');
            const scrollPosition = window.scrollY;

            if (scrollPosition > 0) {
                scrollReminder.classList.add('hidden');
            } else {
                scrollReminder.classList.remove('hidden');
            }
        });
    };
    document.getElementById("loadMoreButton").addEventListener("click", function() {
        localImgData(currentPage)
    });

    function localImgData(current){
        loading=true;
        var mainPageImageFlow = new XMLHttpRequest();
        mainPageImageFlow.open("GET", "/base/anakki/record/flow?imageType=MAINPAGE_FLOW&current="+current+"&size"+size, true);
        mainPageImageFlow.onreadystatechange = function () {
            if (mainPageImageFlow.readyState === 4 && mainPageImageFlow.status === 200) {
                const response = JSON.parse(mainPageImageFlow.responseText);
                const itemList = response.data.data;
                if (!(Array.isArray(itemList) && itemList.length === 0)){
                    currentPage=currentPage+1;
                    for (let i = 0; i < itemList.length; i++) {
                        const item = itemList[i];

                        const dateTime = new Date(item.photoTime);
                        const year = dateTime.getFullYear();
                        const month = dateTime.getMonth() + 1; // Months are zero-based, so we add 1
                        const day = dateTime.getDate();
                        const formattedDate = year + "-" + month + "-" + day;
                        const photoBy = item.photoBy;
                        const fileSize = item.fileSize;
                        const fileSizeDisplay = fileSize >= 1024 ? (fileSize / 1024).toFixed(2) + " MB" : fileSize + " KB";
                        var itemHtml = document.createElement("div")
                        itemHtml.className = 'col-12';
                        itemHtml.innerHTML=
                            "<figure class='figure'>" +
                                "<img src='" + item.imgUrl + "' class=\"figure-img img-fluid rounded\" alt=\"" + item.id + "\" onclick=\"showModal(this)\">" +
                                "<figcaption class='figure-caption'>" +
                                    "<span style='float:right'><i class='fas fa-eye'></i> " + item.viewCount + "</span>" +
                                    "<strong>" +
                                    item.title + " - " + item.location +
                                    "</strong> " +
                                "</figcaption>" +
                                "<figcaption class='figure-caption'>拍摄日期:" +
                                    formattedDate +
                                "</figcaption>" +
                                "<figcaption class='figure-caption'>摄影师:" +
                                    photoBy +
                                "</figcaption>" +
                                "<p class=\"card-text\">" +
                                "<small class=\"text-muted\">图片尺寸: " +
                                item.imageSize + " | 大小: " + fileSizeDisplay +
                                    "<span id='"+"likeId_"+item.id+"' onclick=\"like("+item.id+")\" style='float:right'>"+
                                        "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" class=\"bi bi-heart\" viewBox=\"0 0 16 16\">\n" +
                                        "  <path d=\"m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01L8 2.748zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15z\"/>\n" +
                                        "</svg>"+
                                        item.likeCount +
                                    "</span>" +
                                    "<span id='"+"unLikeId_"+item.id+"' onclick=\"unLike("+item.id+")\" style='float:right'>" +
                                        "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" class=\"bi bi-heartbreak\" viewBox=\"0 0 16 16\">\n" +
                                        "  <path d=\"M8.867 14.41c13.308-9.322 4.79-16.563.064-13.824L7 3l1.5 4-2 3L8 15a38.094 38.094 0 0 0 .867-.59Zm-.303-1.01-.971-3.237 1.74-2.608a1 1 0 0 0 .103-.906l-1.3-3.468 1.45-1.813c1.861-.948 4.446.002 5.197 2.11.691 1.94-.055 5.521-6.219 9.922Zm-1.25 1.137a36.027 36.027 0 0 1-1.522-1.116C-5.077 4.97 1.842-1.472 6.454.293c.314.12.618.279.904.477L5.5 3 7 7l-1.5 3 1.815 4.537Zm-2.3-3.06-.442-1.106a1 1 0 0 1 .034-.818l1.305-2.61L4.564 3.35a1 1 0 0 1 .168-.991l1.032-1.24c-1.688-.449-3.7.398-4.456 2.128-.711 1.627-.413 4.55 3.706 8.229Z\"/>\n" +
                                        "</svg>"+
                                        item.unlikeCount +
                                    "</span>" +
                                "</small>" +
                            " </figure>";
                        document.getElementById("mainFlow").appendChild(itemHtml);
                    }
                }else{
                    document.getElementById("loadMoreButton").innerHTML="我也是有底线的";
                }
                loading=false;
            }
        };
        mainPageImageFlow.send();
    }

    function mainPageHead(){
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "/base/system/getStringConfigValue?key=MAIN_PAGE_HEAD", true);
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                const response = JSON.parse(xhr.responseText);
                const item = response.data;
                document.getElementById("mainPageHead").innerHTML=item;
            }
        };
        xhr.send();
    }
    function like(id){
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "/api/anakki/record/like?id="+id, true);
        xhr.setRequestHeader('authorization', localStorage.getItem('user-token')); // Include the token in the Authorization header
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                const response = JSON.parse(xhr.responseText);
                const item = response.data;
                const html=
                    "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" class=\"bi bi-heart-fill\" viewBox=\"0 0 16 16\">\n" +
                    "  <path fill-rule=\"evenodd\" d=\"M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z\"/>\n" +
                    "</svg>"+ item
                document.getElementById("likeId_"+id).innerHTML=html;
            }
        };
        xhr.send();
    }
    function unLike(id){
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "/api/anakki/record/unLike?id="+id, true);
        xhr.setRequestHeader('authorization', localStorage.getItem('user-token')); // Include the token in the Authorization header
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                const response = JSON.parse(xhr.responseText);
                const item = response.data;
                const html=
                    "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" class=\"bi bi-heartbreak-fill\" viewBox=\"0 0 16 16\">\n" +
                    "  <path d=\"M8.931.586 7 3l1.5 4-2 3L8 15C22.534 5.396 13.757-2.21 8.931.586ZM7.358.77 5.5 3 7 7l-1.5 3 1.815 4.537C-6.533 4.96 2.685-2.467 7.358.77Z\"/>\n" +
                    "</svg>"+ item;
                document.getElementById("unLikeId_"+id).innerHTML=html;
            }
        };
        xhr.send();
    }

    function mainPageHead(){
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "/base/system/getStringConfigValue?key=MAIN_PAGE_HEAD", true);
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                const response = JSON.parse(xhr.responseText);
                document.getElementById("mainPageHead").innerHTML=response.data;
            }
        };
        xhr.send();
    }
    function up(){
        const number = window.scrollY + window.innerHeight;
        if (number >= document.body.scrollHeight-20&&!loading&&!lastPage) {
            localImgData(currentPage);
        }
    }
    function isMobileDevice() {
        return /Mobi/.test(navigator.userAgent);
    }

    EventUtil.listenTouchDirection(document,true,up,false,false,false)


    function showModal(image) {


        var get = new XMLHttpRequest();
        get.open("GET", "/base/anakki/record/flowById?id=" + image.alt, true);
        get.onreadystatechange = function () {
            if (get.readyState === 4 && get.status === 200) {
                let downLoadAlert;
                var response = JSON.parse(get.responseText);
                var item = response.data;

                var dateTime = new Date(item.photoTime);
                var year = dateTime.getFullYear();
                var month = dateTime.getMonth() + 1; // Months are zero-based, so we add 1
                var day = dateTime.getDate();
                var formattedDate = year + "-" + month + "-" + day;
                var fileSize = item.fileSize;
                var fileSizeDisplay = fileSize >= 1024 ? (fileSize / 1024).toFixed(2) + " MB" : fileSize + " KB";

                if (isMobileDevice()) {
                    downLoadAlert= "长按图片无损保存原图(消耗"+fileSizeDisplay+"),双指可放大原图"
                } else {
                    downLoadAlert= "右击图片无损保存原图(消耗"+fileSizeDisplay+")"
                }

                var html =
                    "<div style='width: 100%;background: #000000b2;height: 100%;'>\n" +
                        "<img src=\"" + item.imgUrl + "\" class=\"modal-image rounded\" alt=\"...\">\n" +
                    "</div>" +
                    "<div class=\"card-body windows-bottom\">\n" +
                        "<p>" +
                            "<small class=\"text-muted\">" +
                                downLoadAlert+
                            "</small>" +
                        "</p>\n" +
                        "<h5 class=\"card-title\"  style='color: #fff;'>" +
                            "标题:"+ item.title +" &nbsp;|&nbsp; "+item.viewCount +"<i class='fas fa-eye'></i>"+
                        "</h5>\n" +
                        "<p>" +
                            "<small class=\"text-muted\">" +
                            "描述:"+item.description +
                            "</small>" +
                        "</p>" +
                        "<p>" +
                            "<small class=\"text-muted\">" +
                                "拍摄日期:"+  formattedDate +
                            "</small>" +
                        "</p>\n" +
                        "<p>" +
                            "<small class=\"text-muted\">" +
                            "拍摄位置:"+  item.location +
                            "</small>" +
                        "</p>\n" +
                        "<p>" +
                            "<small class=\"text-muted\">图片尺寸: " +
                                item.imageSize + "&nbsp;|&nbsp;大小: " + fileSizeDisplay +
                            "</small>" +
                        "</p>\n" +
                    "</div>\n"+
                    "<div id='downloadSuccessMessage' style='display: none;'>下载成功!</div>"
                ;
                // Create a modal element
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.style = "display:block";
                modal.style.display = 'flex';
                modal.style.justifyContent = 'center';
                modal.style.alignItems = 'center';
                // Create an image element for the full-screen view
                const fullScreenImage = document.createElement('img');
                fullScreenImage.src = image.src;
                fullScreenImage.className = 'modal-image rounded';
                // Add the image to the modal
                modal.appendChild(fullScreenImage);
                // Add the modal to the document body
                document.body.appendChild(modal);
                // Close the modal when clicked outside the image
                modal.addEventListener('click', function (event) {
                    modal.remove();
                });
                modal.innerHTML = html;
            }
        };
        get.send();
    }
    function showDownloadSuccessMessage() {
        var successMessage = document.getElementById('downloadSuccessMessage');
        successMessage.style.display = 'block';
    }
    function hideModal() {
        var modal = document.getElementById("modal");
        modal.style.display = "none";
    }

    // $(function () {
    //     // 获取图片的宽度(200px)
    //     let imgWidth = $(".figure").outerWidth(); // 200
    //
    //     waterfallHandler();
    //
    //     // 瀑布流处理
    //     function waterfallHandler() {
    //         // 获取图片的列数
    //         let column = parseInt($(window).width() / imgWidth);
    //
    //         // 高度数组
    //         let heightArr = [];
    //         for(let i=0; i<column; i++) {
    //             heightArr[i] = 0;
    //         }
    //
    //         // 遍历所有图片进行定位处理
    //         $.each($('img'), function (index, item) {
    //             // 当前元素的高度
    //             let itemHeight = $(item).outerHeight();
    //             // 高度数组最小的高度
    //             let minHeight = Math.min(...heightArr);
    //             // 高度数组最小的高度的索引
    //             let minIndex = heightArr.indexOf(minHeight);
    //
    //             $(item).css({
    //                 position: 'absolute',
    //                 top: minHeight + 'px',
    //                 left: minIndex * imgWidth + 'px'
    //             });
    //
    //             heightArr[minIndex] += itemHeight;
    //         });
    //     }
    //
    //     // 窗口大小改变
    //     $(window).resize(function () {
    //         waterfallHandler();
    //     });
    // });
</script>
</body>
</html>
