<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="æ—¶å…‰èƒ¶å›Š,Anakkiçš„ä¸ªäººç½‘ç«™,æ‘„å½±,åšå®¢,æŠ€æœ¯åˆ†äº«ã€‚">
    <meta name="author" content="Anakki">
    <title>Anakki-World</title>
    <!-- Fonts -->

    <!-- Theme CSS -->
    <link type="text/css" href="../assets/css/theme.css" rel="stylesheet">
    <!-- Demo CSS - No need to use these in your project -->
    <link type="text/css" href="../assets/css/demo.css" rel="stylesheet">

    <style>
        body {
            color: #495751b8;
            background-color: rgba(3, 94, 0, 0.27);
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .chat-section {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* Your existing CSS styles */
        .chat-header {
            background-color: rgba(0, 204, 126, 0);
            color: white;
            padding: 15px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid rgba(221, 221, 221, 0.16);
            position: fixed;
            top: 60px;
            width: 100%;
            z-index: 1;
        }

        .chat-header h4 {
            margin: 0;
        }

        .chat-header h2 {
            margin-left: 10px;
            color: #f0f0f0;
        }

        .chat-body {
            position: relative;
            flex: 1;
            margin-top: 123px;
            margin-bottom: 60px;
            overflow-y: auto;
            padding: 15px;
            background-color: #ccc0;
            transition: background-color 3s ease, color 3s ease;
        }

        /* å¤´åƒå’ŒèŠå¤©æ°”æ³¡é å³ */
        .chat-message.me {
            justify-content: flex-end;
        }

        .chat-message.me .chat-message-content {
            background-color: rgba(178, 255, 117, 0);
            text-align: right;
            align-self: flex-end; /* ç¡®ä¿èŠå¤©æ°”æ³¡é å³ */
            border-radius: 9px;
        }
        .chat-message.me .chat-message-content p{
            background-color: rgba(178, 255, 117, 0.56);
            text-align: right;
            align-self: flex-end; /* ç¡®ä¿èŠå¤©æ°”æ³¡é å³ */
            border-radius: 9px;
            color: black;
            font-weight: bold;
        }

        .chat-message.me .chat-message-content div{
            background-color: rgba(178, 255, 117, 0);
            text-align: right;
            align-self: flex-end; /* ç¡®ä¿èŠå¤©æ°”æ³¡é å³ */
            border-radius: 9px;
        }
        .chat-message.me img {
            order: 1; /* ç¡®ä¿å¤´åƒåœ¨èŠå¤©æ°”æ³¡åé¢ */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            margin-left: 10px;
            margin-right: 0 !important;
        }

        /* å…¶ä»–èŠå¤©æ¶ˆæ¯çš„æ ·å¼ä¿æŒä¸å˜ */
        .chat-message {
            display: flex;
            margin-bottom: 10px;
        }

        .chat-message img {
            border-radius: 50%;
            width: 40px;
            height: 40px;
            margin-right: 10px; /* é»˜è®¤å¤´åƒåœ¨èŠå¤©æ°”æ³¡å‰é¢ */
        }

        .chat-message-content {
            max-width: 80%;
            border-radius: 9px;
            color: #131313d9;
            background-color: rgba(245, 245, 245, 0);
        }
        .chat-message .chat-message-content div{
            background-color: rgba(178, 255, 117, 0);
            text-align: left;
            align-self: flex-end; /* ç¡®ä¿èŠå¤©æ°”æ³¡é å³ */
            border-radius: 9px;
        }
        .chat-message .chat-message-content p {
            background-color: rgba(0, 0, 0, 0.25);
            padding: 10px;
            border-radius: 10px;
            margin: 0;
            color: white;
            white-space: pre-wrap;
        }

        .chat-footer {
            border-top: 1px solid #0000004d;
            padding: 10px;
            background-color: #242424;
            display: flex;
            align-items: center;
            position: fixed;
            bottom: 0;
            width: 100%;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
        }

        .chat-footer textarea {
            flex: 1;
            margin-right: 10px;
        }

        .chat-footer button {
            background-color: #77777780;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 8px 20px;
        }
        .chat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background-color: #f8f9fa00;
        }

        .chat-title {
            margin-right: auto;
        }

        .room-id {
            margin: 0 auto;
            text-align: center;
        }

        .room-id-input {
            display: flex;
            align-items: center;
        }

        #roomInput {
            margin-right: 10px; /* è¾“å…¥æ¡†å’ŒæŒ‰é’®ä¹‹é—´çš„é—´è· */
        }

        /* ä¾§è¾¹æ æ ·å¼ */
        .sidebar {
            width: 250px;
            background-color: #2c3e50;
            padding: 20px;
            display: none; /* åˆå§‹çŠ¶æ€ä¸‹éšè— */
            flex-shrink: 0;
        }

        .sidebar h3 {
            color: white;
            margin-bottom: 20px;
        }

        .sidebar ul {
            list-style-type: none;
            padding: 0;
        }

        .sidebar ul li {
            margin-bottom: 10px;
            color: #ecf0f1;
            cursor: pointer;
        }
        .chat-message-nickname{
            font-weight: bold;
        }
        .chat-timestamp {
            text-align: center;
            color: #999;
            font-size: 0.8em;
            margin: 10px 0;
            font-style: italic;
        }

        .dark-mode {
            background-color: #333;
            color: #f0f0f0;
        }

        .theme-toggle {
            position: absolute;
            top: 53px;
            right: 46%;
            border: none;
            border-radius: 100%;
            cursor: pointer;
            font-size: 2rem;
            transition: background-color 3s ease, color 3s ease;
            background-color: rgba(51, 51, 51, 0);
        }

        .theme-toggle.dark-mode {
            background-color: rgba(51, 51, 51, 0);
            color: #f0f0f0;
        }
        button:focus {
            outline: 0 dotted;
            outline: 0 auto -webkit-focus-ring-color;
        }
        .form-control {
            display: block;
            width: 100%;
            padding: .4rem 0.5rem;
            font-size: .875rem;
            line-height: 1.6;
            color: #495057;
            background-color: #fff0;
            background-clip: padding-box;
            border: .0625rem solid #ced4da40;
            border-radius: .375rem;
            box-shadow: none;
            transition: all 0.2s ease-in-out;
        }
    </style>

</head>
<body>
<!--é€šç”¨é¡¶éƒ¨å¯¼èˆª-->
<div id="header"></div>
<main class="main">
    <div class="bg-cover bg-size--cover" data-spotlight="fullscreen"
         style="background-image: url('https://securex-1258150206.cos.ap-beijing.myqcloud.com/backend/DSC07694.jpg')">
        <div class="chat-section">
            <!-- Chat Header -->
            <div class="chat-header">
                <h4 class="chat-title toggle-sidebar-button" id="toggleSidebarButton">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-grid" viewBox="0 0 16 16">
                        <path d="M1 2.5A1.5 1.5 0 0 1 2.5 1h3A1.5 1.5 0 0 1 7 2.5v3A1.5 1.5 0 0 1 5.5 7h-3A1.5 1.5 0 0 1 1 5.5v-3zM2.5 2a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3zm6.5.5A1.5 1.5 0 0 1 10.5 1h3A1.5 1.5 0 0 1 15 2.5v3A1.5 1.5 0 0 1 13.5 7h-3A1.5 1.5 0 0 1 9 5.5v-3zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3zM1 10.5A1.5 1.5 0 0 1 2.5 9h3A1.5 1.5 0 0 1 7 10.5v3A1.5 1.5 0 0 1 5.5 15h-3A1.5 1.5 0 0 1 1 13.5v-3zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3zm6.5.5A1.5 1.5 0 0 1 10.5 9h3a1.5 1.5 0 0 1 1.5 1.5v3a1.5 1.5 0 0 1-1.5 1.5h-3A1.5 1.5 0 0 1 9 13.5v-3zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3z"/>
                    </svg>
                </h4>
                <button id="themeToggle" class="theme-toggle">ğŸŒ•</button>
                <div class="room-id-input">
                    <input class="form-control" type="text" id="roomInput" placeholder="è¯·è¾“å…¥æˆ¿é—´å·" data-emojiable="true">
                    <div class="btn input-group-append" id="setRoomIdButton" class="btn btn-default">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-clockwise" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                            <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Chat Body -->
            <!-- Chat content here -->

            <div class="chat-body" id="chatContent">
            </div>
            <!-- Chat Footer -->
            <div class="chat-footer">
                <textarea id="message-input" class="form-control" data-emojiable="true" placeholder="è¾“å…¥æ¶ˆæ¯..." rows="1" style="resize: none;"></textarea>
                <button type="button" id="send-button">å‘é€</button>
            </div>
        </div>
    </div>
</main>
<!-- é¡µé¢åº•éƒ¨ -->
<div id="footer"></div>
<!-- Core -->
<script src="../assets/vendor/jquery/jquery.min.js"></script>
<script src="../assets/vendor/popper/popper.min.js"></script>
<script src="../assets/js/bootstrap/bootstrap.min.js"></script>
<!-- FontAwesome 5 -->
<script src="../assets/vendor/fontawesome/js/fontawesome-all.min.js" defer></script>
<!-- Page plugins -->
<script src="../assets/vendor/bootstrap-select/js/bootstrap-select.min.js"></script>
<script src="../assets/vendor/bootstrap-tagsinput/bootstrap-tagsinput.min.js"></script>
<script src="../assets/vendor/input-mask/input-mask.min.js"></script>
<script src="../assets/vendor/nouislider/js/nouislider.min.js"></script>
<script src="../assets/vendor/textarea-autosize/textarea-autosize.min.js"></script>
<!-- Theme JS -->
<script src="../assets/js/theme.js"></script>



<script>
    // æ˜¯å¦æ­£åœ¨åŠ è½½æ•°æ®çš„æ ‡å¿—
    let isLoading = false;
    const setRoomIdButton = document.getElementById('setRoomIdButton');
    const roomInput = document.getElementById('roomInput');
    const roomIdElement = document.getElementById('roomId');
    const chatContent = document.getElementById('chatContent');
    const roomName = document.getElementById('roomName');
    let oldRoomId;
    let roomId;

    // æ˜¯å¦æœ‰æ›´å¤šæ•°æ®çš„æ ‡å¿—
    let hasMoreData = true;
    let currentMessageId='';
    let firstMessageId='';
    // ç›‘å¬æ»šåŠ¨äº‹ä»¶
    chatContent.addEventListener('scroll', handleScroll);
    async function handleScroll() {
        // æ£€æŸ¥æ˜¯å¦æ­£åœ¨åŠ è½½æ•°æ®
        if (isLoading) return;

        // å½“æ»šåŠ¨æ¡æ»šåŠ¨åˆ°é¡¶éƒ¨ä¸”è¿˜æœ‰æ›´å¤šæ•°æ®æ—¶ï¼Œè¿›è¡Œæ•°æ®åŠ è½½
        if (chatContent.scrollTop === 0 && hasMoreData) {
            // è®¾ç½®ä¸ºæ­£åœ¨åŠ è½½
            isLoading = true;

            // è°ƒç”¨æ•°æ®åŠ è½½å‡½æ•°
            await fetchChatData()
        }
    }
    const textarea = document.getElementById('message-input');
    // ç¦ç”¨å›è½¦é”®è§¦å‘å‘é€
    textarea.addEventListener('keydown', function(event) {
        if (event.key === 'Enter' && !event.shiftKey) {
            event.preventDefault(); // é˜»æ­¢é»˜è®¤è¡Œä¸º
            // è¿™é‡Œå¯ä»¥é€‰æ‹©è‡ªåŠ¨å‘é€æˆ–è€…ä»€ä¹ˆä¹Ÿä¸åš
            // sendButton.click(); // è‡ªåŠ¨è§¦å‘å‘é€æŒ‰é’®
        }
    });
    document.addEventListener('DOMContentLoaded', function () {

        setRoomIdButton.addEventListener('click', function () {
            roomId = roomInput.value.trim();
            if (roomId) {
                fetchChatNewData();
            } else {
                alert('è¯·è¾“å…¥æˆ¿é—´å·');
            }
        });
    });
    document.getElementById('themeToggle').addEventListener('click', function() {
        const chatBody = document.getElementById('chatContent');
        const button = document.getElementById('themeToggle');

        // Toggle dark mode
        if (chatBody.classList.contains('dark-mode')) {
            chatBody.classList.remove('dark-mode');
            button.textContent = 'ğŸŒ•'; // Moon icon for dark mode
            button.classList.remove('dark-mode');
        } else {
            chatBody.classList.add('dark-mode');
            button.textContent = 'ğŸŒ™'; // Sun icon for light mode
            button.classList.add('dark-mode');
        }
    });
    async function displayChatMessages(messages) {
        let lastTimestamp = null;

        messages.forEach(message => {
            const messageElement = document.createElement('div');
            messageElement.className = 'chat-message';

            // æ·»åŠ ç”¨æˆ·å¤´åƒ
            const avatarImg = document.createElement('img');
            avatarImg.src = message.avatar || 'https://via.placeholder.com/40?text=U';
            avatarImg.alt = message.nickname || 'User';
            messageElement.appendChild(avatarImg);

            // æ·»åŠ æ¶ˆæ¯å†…å®¹
            const contentDiv = document.createElement('div');
            contentDiv.className = 'chat-message-content';
            // æ·»åŠ æ¶ˆæ¯äººæ˜µç§°
            const nicknameDiv = document.createElement('div');
            nicknameDiv.className = 'chat-message-nickname';
            nicknameDiv.textContent = message.nickname || 'User';
            contentDiv.appendChild(nicknameDiv);

            if (message.contentType === 'image') {
                contentDiv.innerHTML = `<img src="${message.content}" alt="image">`;
            } else if (message.contentType === 'video') {
                contentDiv.innerHTML = `<video controls><source src="${message.content}" type="video/mp4">æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ ‡ç­¾ã€‚</video>`;
            } else {
                const textP = document.createElement('p');
                textP.textContent = message.content;
                contentDiv.appendChild(textP);
            }

            messageElement.appendChild(contentDiv);

            // å¦‚æœæ˜¯å½“å‰ç”¨æˆ·çš„æ¶ˆæ¯ï¼Œæ·»åŠ  'me' ç±»
            if (message.nickname === localStorage.getItem("nickname")) { // `currentUserId` æ˜¯ä½ éœ€è¦å®šä¹‰çš„å½“å‰ç”¨æˆ·çš„ ID
                messageElement.classList.add('me');
            }
            // å¤„ç†æ—¶é—´æˆ³
            const currentTimestamp = new Date(message.createTime);
            if (lastTimestamp != null && (lastTimestamp-currentTimestamp ) >= 5 * 60 * 1000) {
                const timestampDiv = document.createElement('div');
                timestampDiv.className = 'chat-timestamp';
                timestampDiv.textContent = formatTimestamp(currentTimestamp);

                chatContent.prepend(timestampDiv);
            }
            lastTimestamp = currentTimestamp;
            chatContent.prepend(messageElement);
        });

    }
    async function displayNewChatMessages(messages) {
        let lastTimestamp = null;

        messages.forEach(message => {
            const messageElement = document.createElement('div');
            messageElement.className = 'chat-message';

            // æ·»åŠ ç”¨æˆ·å¤´åƒ
            const avatarImg = document.createElement('img');
            avatarImg.src = message.avatar || 'https://via.placeholder.com/40?text=U';
            avatarImg.alt = message.nickname || 'User';
            messageElement.appendChild(avatarImg);

            // æ·»åŠ æ¶ˆæ¯å†…å®¹
            const contentDiv = document.createElement('div');
            contentDiv.className = 'chat-message-content';
            // æ·»åŠ æ¶ˆæ¯äººæ˜µç§°
            const nicknameDiv = document.createElement('div');
            nicknameDiv.className = 'chat-message-nickname';
            nicknameDiv.textContent = message.nickname || 'User';
            contentDiv.appendChild(nicknameDiv);

            if (message.contentType === 'image') {
                contentDiv.innerHTML = `<img src="${message.content}" alt="image">`;
            } else if (message.contentType === 'video') {
                contentDiv.innerHTML = `<video controls><source src="${message.content}" type="video/mp4">æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ ‡ç­¾ã€‚</video>`;
            } else {
                const textP = document.createElement('p');
                textP.textContent = message.content;
                contentDiv.appendChild(textP);
            }

            messageElement.appendChild(contentDiv);

            // å¦‚æœæ˜¯å½“å‰ç”¨æˆ·çš„æ¶ˆæ¯ï¼Œæ·»åŠ  'me' ç±»
            if (message.nickname === localStorage.getItem("nickname")) { // `currentUserId` æ˜¯ä½ éœ€è¦å®šä¹‰çš„å½“å‰ç”¨æˆ·çš„ ID
                messageElement.classList.add('me');
            }
            // å¤„ç†æ—¶é—´æˆ³
            const currentTimestamp = new Date(message.createTime);
            if (lastTimestamp != null && (currentTimestamp-lastTimestamp) >= 5 * 60 * 1000) {
                const timestampDiv = document.createElement('div');
                timestampDiv.className = 'chat-timestamp';
                timestampDiv.textContent = formatTimestamp(currentTimestamp);

                chatContent.appendChild(timestampDiv);
            }
            lastTimestamp = currentTimestamp;
            chatContent.appendChild(messageElement);
        });
    }
    function formatTimestamp(timestamp) {
        const now = new Date();
        const messageDate = new Date(timestamp);
        const options = { hour: '2-digit', minute: '2-digit', hour12: false, timeZone: 'Asia/Shanghai' };

        const timeString = messageDate.toLocaleTimeString('zh-CN', options);

        // å¦‚æœæ˜¯ä»Šå¤©
        if (now.toDateString() === messageDate.toDateString()) {
            return `ä»Šå¤© ${timeString}`;
        }

        // å¦‚æœæ˜¯æ˜¨å¤©
        const yesterday = new Date();
        yesterday.setDate(now.getDate() - 1);
        if (yesterday.toDateString() === messageDate.toDateString()) {
            return `æ˜¨å¤© ${timeString}`;
        }

        // æ˜¾ç¤ºå®Œæ•´æ—¥æœŸ
        const month = messageDate.getMonth() + 1; // æœˆä»½æ˜¯0-11
        const day = messageDate.getDate();
        return `${month}æœˆ${day}æ—¥ ${timeString}`;
    }
    async function fetchChatData() {
        // ç¦ç”¨åˆ·æ–°æŒ‰é’®
        setRoomIdButton.disabled = true;
        if (!roomId) {
            alert('è¯·è®¾ç½®æˆ¿é—´å·');
            return;
        }
        const token = localStorage.getItem('user-token');
        if (null == token) {
            alert("è¯·ç™»å½•")
        }
        fetch('/api/anakki/chat/receive-from-room', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'authorization': token
            },
            body: JSON.stringify({
                roomId: roomId,
                firstIndex: firstMessageId
            })
        })
            .then(response => response.json())
            .then(data => {
                if (data.code === 200) {
                    if (data.data.length===0){
                        // æ²¡æœ‰æ›´å¤šæ•°æ®äº†
                        hasMoreData = false;
                        alert('æ²¡æœ‰æ›´å¤šæ•°æ®');
                    }
                    if (!firstMessageId){
                        firstMessageId=data.data[data.data.length-1].id
                    }else if (data.data[data.data.length-1].id<firstMessageId){
                        firstMessageId=data.data[data.data.length-1].id
                    }
                    displayChatMessages(data.data);
                    //roomIdElement.textContent = roomId;
                } else {
                    alert(data.message || 'è·å–æ•°æ®å¤±è´¥');
                }
            })
            .catch(error => {
                console.error('Error:', error);
            }).finally(() => {
            // å®Œæˆåé‡æ–°å¯ç”¨åˆ·æ–°æŒ‰é’®
            setRoomIdButton.disabled = false;
            isLoading=false;
        });
    }
    // setInterval(fetchChatNewData, 5000);

    async function fetchChatNewData() {
        if (!oldRoomId) {
            oldRoomId = roomInput.value.trim();
            roomId = roomInput.value.trim();
        } else {
            if (oldRoomId !== roomInput.value.trim()) {
                currentMessageId = null;
            }
        }

        // ç¦ç”¨åˆ·æ–°æŒ‰é’®
        setRoomIdButton.disabled = true;
        if (!roomId) {
            alert('è¯·è®¾ç½®æˆ¿é—´å·');
            setRoomIdButton.disabled = false; // ç¡®ä¿åœ¨è¾“å…¥æˆ¿é—´å·åæŒ‰é’®ä¸ä¼šç¦ç”¨
            return;
        }

        const token = localStorage.getItem('user-token');
        if (!token) {
            alert('è¯·ç™»å½•');
            setRoomIdButton.disabled = false; // ç¡®ä¿åœ¨æœªç™»å½•æ—¶æŒ‰é’®ä¸ä¼šç¦ç”¨
            return;
        }

        try {
            const response = await fetch('/api/anakki/chat/receive-new-from-room', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'authorization': token
                },
                body: JSON.stringify({
                    roomId: roomId,
                    currentIndex: currentMessageId
                })
            });

            const data = await response.json();

            if (data.code === 200) {
                if (data.data.length > 0) {
                    currentMessageId = data.data[data.data.length - 1].id;
                    if (!firstMessageId) {
                        firstMessageId = data.data[0].id;
                    } else if (data.data[0].id < firstMessageId) {
                        firstMessageId = data.data[0].id;
                    }
                    await displayNewChatMessages(data.data);
                }
            } else {
                alert(data.message);
            }
        } catch (error) {
            console.error('Error:', error);
        } finally {
            // å®Œæˆåé‡æ–°å¯ç”¨åˆ·æ–°æŒ‰é’®
            setRoomIdButton.disabled = false;
        }
    }


    window.onload = function () {
        $('#header').load("../pages/header.html", loadPersonDetail);

        // å‘é€æ¶ˆæ¯çš„æŒ‰é’®å’Œè¾“å…¥æ¡†
        const sendButton = document.getElementById('send-button');
        const messageInput = document.getElementById('message-input');

        sendButton.addEventListener('click', function () {
            // è·å–è¾“å…¥æ¡†çš„æ¶ˆæ¯å†…å®¹
            const messageContent = messageInput.value;

            if (messageContent.trim() === '') {
                alert('è¯·è¾“å…¥æ¶ˆæ¯å†…å®¹');
                return;
            }

            // æ„é€ è¯·æ±‚ä½“
            const requestPayload = {
                isTemp: false, // æ ¹æ®éœ€æ±‚è®¾ç½®
                roomId: roomId, // æ›¿æ¢ä¸ºå®é™…çš„æˆ¿é—´ID
                content: messageContent,
                contentType: 'text' // æ ¹æ®éœ€æ±‚è®¾ç½®
            };

            const token = localStorage.getItem('user-token');
            if (null == token) {
                alert("è¯·ç™»å½•")
            }
            sendButton.disabled = true;
            // å‘é€è¯·æ±‚åˆ°åç«¯
            fetch('/api/anakki/chat/send-to-room', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'authorization': token
                },
                body: JSON.stringify(requestPayload)
            })
                .then(response => response.json())
                .then(data => {
                    if (data.data) {
                        // æ¶ˆæ¯å‘é€æˆåŠŸï¼Œæ¸…ç©ºè¾“å…¥æ¡†
                        messageInput.value = '';
                        // å¤„ç†æ¶ˆæ¯å‘é€æˆåŠŸçš„é€»è¾‘ï¼Œä¾‹å¦‚å°†æ¶ˆæ¯æ·»åŠ åˆ°èŠå¤©è®°å½•ä¸­
                        console.log('æ¶ˆæ¯å‘é€æˆåŠŸ');
                        fetchChatNewData()
                        sendButton.disabled = false;
                    } else {
                        // å¤„ç†æ¶ˆæ¯å‘é€å¤±è´¥çš„é€»è¾‘
                        console.error('æ¶ˆæ¯å‘é€å¤±è´¥');
                    }
                })
                .catch(error => {
                    console.error('å‘é€è¯·æ±‚å¤±è´¥', error);
                });
        });
    }

    document.getElementById('message-input').addEventListener('focus', function() {
        // è®©è¾“å…¥æ¡†æ»šåŠ¨åˆ°è§†å›¾ä¸­
        this.scrollIntoView({ behavior: 'smooth' });
    });
</script>
</body>
</html>
