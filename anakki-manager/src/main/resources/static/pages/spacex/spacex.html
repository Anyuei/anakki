<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="时光胶囊,Anakki的个人网站,摄影,博客,技术分享。">
    <meta name="author" content="Anakki">
    <title>Anakki-World</title>
    <link type="text/css" href="../../assets/css/theme.css" rel="stylesheet">
    <link type="text/css" href="../../assets/css/demo.css" rel="stylesheet">
</head>
<style>
    .row {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 0.5rem 0;
    }

    .image-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
    }

    .image-spacex-list {
        height: auto;
        border-radius: 1rem;
    }

    .image-info {
        font-size: 0.775rem;
        text-align: center;
        margin-top: 0.5rem;
    }

    .modal-spacex {
        background-color: rgba(0, 0, 0, 0.8);
        justify-content: center;
        align-items: center;
        z-index: 9999;
        text-align: center;
        position: fixed;
        inset: 0;
        margin: auto;
        width: 100%;
        height: 100vh;
        display: flex;
        flex-direction: column;
    }

    .image-open {
        text-align: right;
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: rgba(0, 0, 0, 0);
        color: white;
        padding: 5px;
    }

    .image-open .photo-time {
        display: block;
    }

    .image-open .view-count {
        display: block;
    }

    .image-open .view-count i {
        margin-right: 5px;
    }

    body {
        color: #aeaeae;
        background-color: #000000b8;
    }

    video {
        max-width: 100%;
        max-height: 100%;
        border-radius: 1rem;
    }
</style>
<body>
<!--通用顶部导航-->
<div id="header"></div>
<main class="main">
    <section style="padding-top: 4rem;">
        <div class="container-fluid text-center justify-content-center" id="spacexFlow">
        </div>
    </section>
</main>
<!-- 页面底部 -->
<div id="footer"></div>
<!-- Core -->
<script src="../../assets/vendor/jquery/jquery.min.js"></script>
<script src="../../assets/vendor/popper/popper.min.js"></script>
<script src="../../assets/js/bootstrap/bootstrap.min.js"></script>
<!-- FontAwesome 5 -->
<script src="../../assets/vendor/fontawesome/js/fontawesome-all.min.js" defer></script>
<!-- Page plugins -->
<script src="../../assets/vendor/bootstrap-select/js/bootstrap-select.min.js"></script>
<script src="../../assets/vendor/bootstrap-tagsinput/bootstrap-tagsinput.min.js"></script>
<script src="../../assets/vendor/input-mask/input-mask.min.js"></script>
<script src="../../assets/vendor/nouislider/js/nouislider.min.js"></script>
<script src="../../assets/vendor/textarea-autosize/textarea-autosize.min.js"></script>
<!-- Theme JS -->
<script src="../../assets/js/theme.js"></script>
<script>
    window.onload = function () {
        $('#header').load("../../pages/header.html", loadPersonDetail);
        $('#footer').load("../../pages/footer.html", insertCreateTime);

        var imageXHR = new XMLHttpRequest();
        imageXHR.open("GET", "/base/anakki/record/flow?imageType=SPACEX", true);
        imageXHR.onreadystatechange = function () {
            if (imageXHR.readyState === 4 && imageXHR.status === 200) {
                var html = "";
                var response = JSON.parse(imageXHR.responseText);
                var itemList = response.data.data;
                for (let i = 0; i < itemList.length; i++) {
                    const item = itemList[i];
                    const viewCount = item.viewCount;
                    let formattedDate;
                    if (item.photoTime) {
                        const dateTime = new Date(item.photoTime);
                        const year = dateTime.getFullYear();
                        const month = dateTime.getMonth() + 1;
                        const day = dateTime.getDate();
                        formattedDate = year + "-" + month + "-" + day;
                    } else {
                        formattedDate = "未知";
                    }

                    // 展示图片列表
                    html += '<div class="row">';
                    html += '<div class="image-item">';
                    html += '<img src="' + item.imgUrl + '?imageMogr2/thumbnail/400x" class="image-spacex-list img-fluid" alt="' + item.id + '" onclick="showModal(this, \'' + item.imgUrl + '\')">';
                    html += '<div class="image-info">';
                    html += '<span class="photo-time">拍摄时间: ' + formattedDate + '  |  </span>';
                    html += '<span class="view-count"><i class="fas fa-eye"></i> ' + viewCount + '</span><br>';
                    html += '<span>' + "点击图片查看原图或播放视频" + '</span><br>';
                    html += '</div>';
                    html += '</div>';
                    html += '</div>';
                }
                document.getElementById("spacexFlow").innerHTML = html;
            }
        };
        imageXHR.send();
    };

    function showModal(image, url) {
        var get = new XMLHttpRequest();
        get.open("GET", "/base/anakki/record/flowById?id=" + image.alt, true);
        get.onreadystatechange = function () {
            if (get.readyState === 4 && get.status === 200) {
                var response = JSON.parse(get.responseText);
                var item = response.data;
                var imgUrl = item.imgUrl;
                var dateTime = new Date(item.photoTime);
                var year = dateTime.getFullYear();
                var month = dateTime.getMonth() + 1;
                var day = dateTime.getDate();
                var formattedDate = year + "-" + month + "-" + day;

                var modal = document.createElement("div");
                modal.classList.add("modal-spacex");

                var mediaElement;
                if (url.endsWith(".mp4")) {
                    mediaElement = document.createElement("video");
                    mediaElement.controls = true;
                    mediaElement.poster = imgUrl; // 使用视频封面
                    mediaElement.src = url;
                } else {
                    mediaElement = document.createElement("img");
                    mediaElement.src = imgUrl;
                }

                mediaElement.style.maxWidth = "100%";
                mediaElement.style.maxHeight = "100%";

                var imageInfo = document.createElement("div");
                imageInfo.classList.add("image-open");
                imageInfo.innerHTML = "<span class='photo-time'>拍摄时间: " + formattedDate + "</span><hr>" +
                    "<span class='view-count'><i class='fas fa-eye'></i> " + item.viewCount + "</span>";

                modal.appendChild(mediaElement);
                modal.appendChild(imageInfo);
                document.body.appendChild(modal);

                document.querySelector("footer").style.display = "none";
                document.addEventListener("click", closeModal);
            }
        };
        get.send();
    }

    function closeModal() {
        var modal = document.querySelector(".modal-spacex");
        modal.parentNode.removeChild(modal);
        document.querySelector("footer").style.display = "block";
    }
</script>
</body>
</html>
