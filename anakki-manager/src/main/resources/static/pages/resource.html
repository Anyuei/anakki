<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description"
          content="时光胶囊,Anakki的个人网站,摄影,博客,技术分享。                             ">
    <meta name="author" content="Anakki">
    <title>Anakki-World</title>
    <!-- Fonts -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Theme CSS -->
    <link type="text/css" href="../assets/css/theme.css" rel="stylesheet">
    <!-- Demo CSS - No need to use these in your project -->
    <link type="text/css" href="../assets/css/demo.css" rel="stylesheet">
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta
            content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"
            name="viewport"
    />
    <link rel="stylesheet" href="../assets/js/view/viewer.min.css">
</head>
<style>
    .card {
        border-radius: 0.6rem;
    }
    .card {
        position: relative;
        display: flex;
        flex-direction: column;
        min-width: 0;
        word-wrap: break-word;
        background-color: #fff0;
        background-clip: border-box;
        border: 0 solid rgba(0, 0, 0, 0.05);
        border-radius: 0.8rem;
        box-shadow: 0 0 24px #00000054;
    }
    .card-img-top {
        width: 100%;
        border-top-left-radius: calc(0.8rem - .0625rem);
        border-top-right-radius: calc(0.8rem - .0625rem);
    }
    .icon {
        width: 1.5rem;
        height: 1rem;
    }

    .table td {
        padding: 0.4rem;
        vertical-align: middle;
        border-top: .125rem solid #dee2e6;
    }

    .truncate {
        max-width: 100px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .row input {
        width: 100%;
    }

    body {
        color: #353535;
        background-color: #665c7b;
    }

    .btn {
        background-color: #0ff0;
    }

    .page-item.active .page-link {
        z-index: 1;
        color: #595959;
        background-color: #008a1c7a;
        border-color: #288cff00;
    }

    .changePageBtn {
        background-color: #fff0 !important;
        border-color: #577da200 !important;
    }

    .btn:hover {
        background-color: rgba(12, 12, 12, 0.51); /* darker color on hover */
    }

    .btn:active {
        background-color: rgba(10, 10, 10, 0.18); /* even darker color when clicked */
    }

    .btn:focus {
        box-shadow: 0 0 10px #333;
    }

    .text-center {
        text-align: justify;
        position: -webkit-sticky;
        position: sticky;
        right: 0;
        z-index: 10;
        border-left: 2px solid #ddd;
        width: auto;
        white-space: nowrap;
    }

    .resource-row {
        transition: all 0.3s ease; /* 添加平滑过渡效果 */
    }

    .resource-row:hover {
        background-color: #0a362263;
        transform: translateY(-2px);
    }

    .header-tab {
    }

    .header-tab-button {
        color: whitesmoke;
        height: 3rem;
        align-items: center;
        justify-content: center;
        display: flex;
        cursor: pointer;
        border-radius: 8px;
        background-color: #24422bc9;
    }

    .header-tab-button:hover {
        transform: translateY(-2px);
        background-color: rgba(36, 66, 43, 0.63);
    }

    #searchPublicInputText {
        height: 2.5rem;
        border-radius: 0.5rem 0 0 0.5rem;
    }

    .image-float-info{
        width: 100%;
        display: flex;
        justify-content: space-between;
        position: absolute;
    }

    .img-avatar-icon {
        width: 2.5rem;
        height: 2rem;
        justify-content: center;
        display: flex;
    }

    .avatar-card-body {
        flex: 1 1 auto;
        padding: 0.5rem;
    }
    .load-more-img{
        justify-content: center;
        display: flex;
        align-content: center;
        width: 100%;
        font-size: 2rem;
    }
    .avatar-card:hover{
        transition: all 0.3s ease; /* 添加平滑过渡效果 */
    }


    .avatar-card:hover{
        transform: translateY(-4px);
        box-shadow: 0 0 24px rgba(0, 0, 0, 0.32);
    }
</style>
<body>
<!--通用顶部导航-->
<div id="header"></div>
<main class="main">
    <div class="container" style="margin-top: 4rem;">
        <div class="header-tab">
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="home-tab" data-toggle="tab" data-target="#home" type="button"
                            role="tab" aria-controls="home" aria-selected="true">
                        <div class="active" id="avatar-tab-button-text">头像资源(0)</div>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="bg-tab" data-toggle="tab" data-target="#bg" type="button"
                            role="tab" aria-controls="bg" aria-selected="false">
                        <div class="" id="bg-tab-button-text">桌面背景(0)</div>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="profile-tab" data-toggle="tab" data-target="#profile" type="button"
                            role="tab" aria-controls="profile" aria-selected="false">
                        <div class="">云文件</div>
                    </button>
                </li>
            </ul>
        </div>
    </div>

    <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
            <div class="container" style="height: 48rem;">
                <div class="row" id="avatar-area">
                    <!-- 动态生成的头像卡片会插入到这里 -->
                </div>
                <div class="row">
                    <div class="load-more-img" >
                        <div style="margin-bottom: 2rem" onclick="listAvatar()">
                            <i class="bi bi-plus-lg" style="cursor: pointer"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="tab-pane fade show" id="bg" role="tabpanel" aria-labelledby="bg-tab">
            <div class="container" style="height: 48rem;">
                <div class="row" id="bg-area">
                    <!-- 动态生成的头像卡片会插入到这里 -->
                </div>
                <div class="row">
                    <div class="load-more-img" >
                        <div style="margin-bottom: 2rem" onclick="listBg()">
                            <i class="bi bi-plus-lg" style="cursor: pointer"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
            <div class="container" style="height: 48rem;">
                <div class="">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex justify-content-between align-items-center" id="searchArea">

                        </div>
                        <span style="display: flex;">
                             <button type="button" class="btn" onclick="listAllResource(1,10)" style="display: flex;">
                                 <span class="d-none d-sm-block">
                                  公共资源
                                 </span>
                                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="22" fill="currentColor"
                                      class="bi bi-people-fill" viewBox="0 0 16 16">
                                      <path d="M7 14s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1H7zm4-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
                                      <path fill-rule="evenodd"
                                            d="M5.216 14A2.238 2.238 0 0 1 5 13c0-1.355.68-2.75 1.936-3.72A6.325 6.325 0 0 0 5 9c-4 0-5 3-5 4s1 1 1 1h4.216z"/>
                                      <path d="M4.5 8a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5z"/>
                                 </svg>
                            </button>

                            <button type="button" class="btn" onclick="list(1,10)" style="display: flex;">
                                  <span class="d-none d-sm-block">
                                  我的资源
                                 </span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="22" fill="currentColor"
                                     class="bi bi-person-up" viewBox="0 0 16 16">
                                  <path fill-rule="evenodd"
                                        d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Zm.354-5.854a.5.5 0 0 0-.708 0l-1.5 1.5a.5.5 0 0 0 .708.708l.646-.647V14.5a.5.5 0 0 0 1 0v-2.793l.646.647a.5.5 0 0 0 .708-.708l-1.5-1.5ZM11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0ZM8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z"/>
                                  <path d="M8.256 14a4.474 4.474 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10c.26 0 .507.009.74.025.226-.341.496-.65.804-.918C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4s1 1 1 1h5.256Z"/>
                                </svg>
                            </button>
                             <button type="button" class="btn" data-toggle="modal"
                                     data-target="#uploadModal">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="22"
                                     fill="currentColor" class="bi bi-upload" viewBox="0 0 16 16" style="width: 3rem;">
                                  <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                                  <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/>
                                </svg>
                            </button>
                         </span>
                    </div>
                    <div class="card-table table-responsive">
                        <table class="table table-vcenter">
                            <thead>
                            <tr>
                                <!--                        <th>标题</th>-->
                                <th style="white-space:nowrap">文件名称</th>
                                <th style="white-space:nowrap">描述</th>
                                <th style="white-space:nowrap">下载量</th>
                                <th style="white-space:nowrap">文件大小</th>
                                <th style="white-space:nowrap">上传用户</th>
                                <th style="min-width: 151px;">上传时间</th>
                                <th style="min-width: 133px;" class="text-center"></th>
                            </tr>
                            </thead>
                            <tbody id="list">
                            </tbody>
                        </table>
                    </div>
                    <hr style="margin-top: 0.5rem;margin-bottom: 0.5rem;">
                    <div class="container">
                        <div class="justify-content-end" style="display: flex;">
                            <ul class="pagination m-0 ms-auto" id="page-module">
                                <li class="page-item disabled">
                                    <a class="page-link" href="#" tabindex="-1" aria-disabled="true">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24"
                                             viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                             stroke-linecap="round" stroke-linejoin="round">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                            <polyline points="15 6 9 12 15 18"></polyline>
                                        </svg>
                                    </a>
                                </li>
                                <li class="page-item"><a class="page-link" href="#">1</a></li>
                                <li class="page-item">
                                    <a class="page-link" href="#">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24"
                                             viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                             stroke-linecap="round" stroke-linejoin="round">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                            <polyline points="9 6 15 12 9 18"></polyline>
                                        </svg>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Modal -->
    <div class="modal" id="uploadModal" tabindex="-1" aria-labelledby="uploadModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="uploadModalLabel">资源上传</h5>
                </div>
                <form class="form-group form-check needs-validation " style="padding-left: 0;" id="uploadImgForm">
                    <div class="modal-body">
                        <div class="row">
                            <input type="text" class="form-control form-control-sm" id="title"
                                   placeholder="请输入标题" required>
                            <div class="invalid-feedback">请输入标题</div>
                        </div>
                        <div class="row">
                            <input type="text" class="form-control form-control-sm" id="description"
                                   placeholder="请输入描述" required>
                            <div class="invalid-feedback">请输入描述</div>
                        </div>
                        <div class="row justify-content-between">
                            <label class="col-sm-6 col-form-label" style="padding-left: 0px;">是否全站公开可见</label>
                            <div class="col-sm-2 d-flex align-items-center" style="padding-right: 0px;">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="isPublic">
                                    <span class="toggle-switch-slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="row justify-content-between">
                            <label class="col-sm-6 col-form-label"
                                   style="padding-left: 0px;">是否临时文件(保存7天)</label>
                            <div class="col-sm-2 d-flex align-items-center" style="padding-right: 0px;">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="isTemporary">
                                    <span class="toggle-switch-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="row">
                            <div class="input-group">
                                <input type="file" name="file-1[]" class="form-control" id="file-1"
                                       aria-describedby="inputGroupFileAddon04" aria-label="Upload">
                            </div>
                            <small class="form-text text-muted">支持1GB以内资源上传</small>
                        </div>
                        <div class="justify-content-between align-items-center row">
                            <div class="col-md-6">
                                <button type="button" class="btn" data-dismiss="modal" style="width: 100%;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                         class="bi bi-x-lg" viewBox="0 0 16 16">
                                        <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="col-md-6">
                                <button type="button" class="btn" onclick="submitForm()" style="width: 100%;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                         class="bi bi-check-lg" viewBox="0 0 16 16">
                                        <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z"/>
                                    </svg>
                                    <div id="progress" class="progress" style="margin-bottom: 0;display: none"
                                         role="progressbar" aria-label="Example with label"
                                         aria-valuenow="0"
                                         aria-valuemin="0" aria-valuemax="100">
                                        <div class="progress-bar" style="width: 0%" id="progressBar">0%</div>
                                    </div>
                                </button>
                            </div>
                        </div>


                    </div>
                </form>


            </div>
        </div>
    </div>
</main>

<!-- Core -->
<script src="../assets/vendor/jquery/jquery.min.js"></script>
<script src="../assets/vendor/popper/popper.min.js"></script>
<script src="../assets/js/bootstrap/bootstrap.min.js"></script>
<!-- FontAwesome 5 -->
<script src="../assets/vendor/fontawesome/js/fontawesome-all.min.js" defer></script>
<!-- Page plugins -->
<script src="../assets/vendor/bootstrap-select/js/bootstrap-select.min.js"></script>
<script src="../assets/vendor/bootstrap-tagsinput/bootstrap-tagsinput.min.js"></script>
<script src="../assets/vendor/input-mask/input-mask.min.js"></script>
<script src="../assets/vendor/nouislider/js/nouislider.min.js"></script>
<script src="../assets/vendor/textarea-autosize/textarea-autosize.min.js"></script>

<!-- Theme JS -->
<script src="../assets/js/theme.js"></script>
<script src="../assets/js/view/viewer.js"></script>
<script>
    window.onload = function () {
        $('#header').load("../pages/header.html", loadPersonDetail);
        $('#footer').load("../pages/footer.html", insertCreateTime);
        listAllResource(1, 10)
        listBg()
        listAvatar()
    }

    // 进度条更新
    function progressHandle(e) {
        const progress = document.querySelector('.progress-bar');
        const percent = (e.loaded / e.total * 100).toFixed(2);
        progress.style.width = percent + "%";
        progress.innerHTML = percent + "%";
    }


    function submitForm() {


        checkFileSize()
        if (null == localStorage.getItem('user-token')) {
            alert("需要登录后上传")
        }
        const title = document.getElementById("title").value;
        const description = document.getElementById("description").value;
        const fileInput = document.getElementById("file-1");
        const isPublic = document.getElementById("isPublic").checked;
        const isTemporary = document.getElementById("isTemporary").checked;

        const files = fileInput.files;

        if (files.length === 0) {
            alert("请选择文件后再上传");
            return; // Prevent form submission
        }

        // 创建FormData对象并添加表单数据
        const formData = new FormData();
        formData.append("title", title);
        formData.append("description", description);
        formData.append("isPublic", isPublic);
        formData.append("isTemporary", isTemporary);
        for (let i = 0; i < files.length; i++) {
            formData.append("files", files[i]);
        }

        const get = new XMLHttpRequest();

        get.open("POST", "/api/anakki/resource/upload");

        get.onreadystatechange = function () {
            const response = JSON.parse(get.responseText);
            if (get.readyState === 4 && get.status === 200) {
                if (response.code === 200) {
                    alert("上传成功");
                    list(1, 10);
                    hideUploadModalAndResetProgress(); // 隐藏模态框并重置进度条
                } else {
                    alert(response.data);
                }
            }
        };
        get.setRequestHeader('authorization', localStorage.getItem('user-token'));
        if (get.upload) {
            const progress = document.getElementById("progress");
            progress.style.display = "block";
            //处理进度条的事件
            get.upload.addEventListener("progress", progressHandle,
                false);
        }
        get.send(formData);
    }

    function hideUploadModalAndResetProgress() {
        $('#uploadModal').modal('hide');
        // 重置进度条
        var progressBar = document.getElementById("progressBar");
        progressBar.value = 0;
        const progress = document.getElementById("progress");
        progress.style.display = "none";
    }

    function searchPublicButton() {
        const input = document.getElementById("searchPublicInputText").value;
        listAllResource(1, 10, input);
    }

    function searchPersonButton() {
        const input = document.getElementById("searchPersonInputText").value;
        let searchInputUrl = "";
        if (null != input && "" !== input) {
            searchInputUrl = "&title=" + input;
        }
        list(1, 10, searchInputUrl);
    }

    function listAllResource(current, pageSize, searchInput) {
        let searchInputUrl = "";
        if (null != searchInput) {
            searchInputUrl = "&title=" + searchInput;
        }
        list(current, pageSize, "&isPublic=true" + searchInputUrl)
    }

    function list(current, pageSize, searchInput) {
        let searchInputUrl = "";
        if (null != searchInput) {
            searchInputUrl = searchInput;
        }
        const url = window.location.href;
        const get = new XMLHttpRequest();
        let base;
        if (null != localStorage.getItem('user-token')) {
            base = "/api";
        } else {
            base = "/base";
        }
        get.open("GET", base + "/anakki/resource/list?current=" + current + "&size=" + pageSize + searchInputUrl, true);
        get.setRequestHeader('authorization', localStorage.getItem('user-token'));
        get.onreadystatechange = function () {
            if (get.readyState === 4 && get.status === 200) {

                let html = "";
                const response = JSON.parse(get.responseText);
                if (200 === response.code) {
                    const itemList = response.data.data;
                    const totalNum = response.data.totalNum;
                    let personSearchHtml;
                    if (null != searchInput && searchInput.includes("isPublic")) {
                        if (searchInput.split("isPublic")[1].split("")[1]) {
                            personSearchHtml =
                                "<div class=\"input-group mb-1  mt-1\">\n" +
                                "<input id=\"searchPublicInputText\" type=\"text\" class=\"form-control\" placeholder=\"全站搜索\"\n" +
                                "                           aria-label=\"全站资源搜索\" aria-describedby=\"button-addon2\">\n" +
                                "                    <button class=\"btn search-button\" type=\"button\" id=\"button-addon2\" onclick=\"searchPublicButton()\" style='height: 2.5rem;'>\n" +
                                "                        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" class=\"bi bi-search\"\n" +
                                "                             viewBox=\"0 0 16 16\">\n" +
                                "                            <path d=\"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z\"/>\n" +
                                "                        </svg>\n" +
                                "                    </button>" +
                                "</div>\n"
                        }
                    } else {
                        personSearchHtml =
                            "<div class=\"input-group mb-1 mt-1\">\n" +
                            "<input id=\"searchPersonInputText\" type=\"text\" class=\"form-control\" placeholder=\"个人搜索\"\n" +
                            "                           aria-label=\"个人资源搜索\" aria-describedby=\"button-addon2\">\n" +
                            "                    <button class=\"btn search-button\" type=\"button\" id=\"button-addon2\" onclick=\"searchPersonButton()\">\n" +
                            "                        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" class=\"bi bi-search\"\n" +
                            "                             viewBox=\"0 0 16 16\">\n" +
                            "                            <path d=\"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z\"/>\n" +
                            "                        </svg>\n" +
                            "                    </button>" +
                            "</div>\n"
                    }
                    document.getElementById("searchArea").innerHTML = personSearchHtml;
                    for (let i = 0; i < itemList.length; i++) {
                        const item = itemList[i];
                        const id = item.id;
                        const type = item.type;
                        const resourceName = item.resourceName;
                        const title = item.title;
                        const downloadCount = item.downloadCount;
                        const description = item.description;
                        const isPublic = item.isPublic;
                        let fileSize;
                        if (item.fileSize < 1024) {
                            fileSize = (item.fileSize).toFixed(2) + "KB"
                        } else if (item.fileSize > 1024 && item.fileSize < 1024 * 1024) {
                            fileSize = (item.fileSize / 1024).toFixed(2) + "MB"
                        } else if (item.fileSize > 1024 * 1024 * 1024) {
                            fileSize = (item.fileSize / (1024 * 1024)).toFixed(2) + "GB"
                        }

                        const createTime = item.createTime.replace("T", " ");
                        const uploadUser = item.uploadUser;
                        let isPublicHTML = ""
                        if (isPublic) {
                            isPublicHTML = " <button class=\"btn\" onclick=\"closeResource(" + id + ")\">" +
                                "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" class=\"bi bi-eye-fill\" viewBox=\"0 0 16 16\">\n" +
                                "  <path d=\"M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z\"/>\n" +
                                "  <path d=\"M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z\"/>\n" +
                                "</svg>" +
                                "</button>\n"
                        } else {
                            isPublicHTML = " <button class=\"btn\" onclick=\"openResource(" + id + ")\">" +
                                "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" class=\"bi bi-eye-slash-fill\" viewBox=\"0 0 16 16\">\n" +
                                "  <path d=\"m10.79 12.912-1.614-1.615a3.5 3.5 0 0 1-4.474-4.474l-2.06-2.06C.938 6.278 0 8 0 8s3 5.5 8 5.5a7.029 7.029 0 0 0 2.79-.588zM5.21 3.088A7.028 7.028 0 0 1 8 2.5c5 0 8 5.5 8 5.5s-.939 1.721-2.641 3.238l-2.062-2.062a3.5 3.5 0 0 0-4.474-4.474L5.21 3.089z\"/>\n" +
                                "  <path d=\"M5.525 7.646a2.5 2.5 0 0 0 2.829 2.829l-2.83-2.829zm4.95.708-2.829-2.83a2.5 2.5 0 0 1 2.829 2.829zm3.171 6-12-12 .708-.708 12 12-.708.708z\"/>\n" +
                                "</svg>" +
                                "</button>\n"
                        }


                        html = html + "                           <tr class='resource-row'>\n" +
                            "                                    <td>" + resourceName + "</td>\n" +
                            "                                    <td class=\"truncate\">" + description + "</td>\n" +
                            "                                    <td>" + downloadCount + "</td>\n" +
                            "                                    <td>" + fileSize + "</td>\n" +
                            "                                    <td>" + uploadUser + "</td>\n" +
                            "                                    <td>" + createTime + "</td>\n" +
                            "    <td class='text-center'>\n" +
                            "        <button class=\"btn\" onclick=\"downloadResource(" + id + ")\">" +
                            "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" class=\"bi bi-cloud-download\" viewBox=\"0 0 16 16\">\n" +
                            "  <path d=\"M4.406 1.342A5.53 5.53 0 0 1 8 0c2.69 0 4.923 2 5.166 4.579C14.758 4.804 16 6.137 16 7.773 16 9.569 14.502 11 12.687 11H10a.5.5 0 0 1 0-1h2.688C13.979 10 15 8.988 15 7.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 2.825 10.328 1 8 1a4.53 4.53 0 0 0-2.941 1.1c-.757.652-1.153 1.438-1.153 2.055v.448l-.445.049C2.064 4.805 1 5.952 1 7.318 1 8.785 2.23 10 3.781 10H6a.5.5 0 0 1 0 1H3.781C1.708 11 0 9.366 0 7.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383z\"/>\n" +
                            "  <path d=\"M7.646 15.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 14.293V5.5a.5.5 0 0 0-1 0v8.793l-2.146-2.147a.5.5 0 0 0-.708.708l3 3z\"/>\n" +
                            "</svg>" +
                            "</button>\n" +
                            " <button class=\"btn\" onclick=\"deleteResource(" + id + ")\">" +
                            "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" class=\"bi bi-trash-fill\" viewBox=\"0 0 16 16\">\n" +
                            "  <path d=\"M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0z\"/>\n" +
                            "</svg>" +
                            "</button>\n" +
                            isPublicHTML +
                            "    </td>\n" +
                            "</tr>"
                    }

                    document.getElementById("list").innerHTML = html;
                    let totalPages = Math.ceil(totalNum / pageSize);
                    initPage(current, pageSize, totalPages, searchInputUrl);
                    // 拼接分页参数到地址栏
                    const newUrl = url.split("?")[0] + "?current=" + current + "&size=" + pageSize + searchInputUrl;
                    window.history.replaceState(null, null, newUrl);
                } else {
                    alert(response.data)
                }
            }
        };

        get.send();
    }

    let avatarResourceCurrent=1;
    let avatarResourcePageSize=18;

    function listAvatar(searchInput) {
        let searchInputUrl = "";
        if (searchInput !== null) {
            searchInputUrl = "&searchKey=" + searchInput;
        }

        const get = new XMLHttpRequest();
        // let base = localStorage.getItem('user-token') ? "/api" : "/base";

        get.open("GET", "/base/anakki/record/avatar-resource?current=" + avatarResourceCurrent + "&size=" + avatarResourcePageSize + searchInputUrl, true);
        get.setRequestHeader('authorization', localStorage.getItem('user-token'));

        get.onreadystatechange = function () {
            if (get.readyState === 4 && get.status === 200) {
                const response = JSON.parse(get.responseText);
                if (response.code === 200) {
                    const itemList = response.data.data;

                    document.getElementById("avatar-tab-button-text").innerText = "头像(" + response.data.totalNum + ")";

                    // 找到 .row 容器
                    const rowContainer = document.getElementById('avatar-area');
                    let interval = 100;

                    // 遍历 itemList，将每个头像生成相应的 HTML
                    itemList.forEach(item => {
                        interval += 100;
                        const cardHTML = `
                        <div class="col-sm-6 col-md-3 col-lg-2 mb-4 div-trans-${interval}">
                            <div class="card avatar-card" id="img-container-${item.id}">
                                <img id="img${item.id}" onclick="showModal(this.alt)" src="${item.imgUrl}" class="card-img-top" alt="${item.id}">
                                <div class="image-float-info">
                                    <div class="img-avatar-icon">
                                        <i class="bi bi-eye" style="font-size: 1rem;">${item.viewCount}</i>
                                    </div>
                                    <div class="img-avatar-icon">
                                        <i class="bi bi-suit-heart" style="font-size: 1rem;">${item.likeCount}</i>
                                    </div>
                                </div>
                                <div class="avatar-card-body" style="font-size: 0.7rem;">
                                    <div class="card-text">尺寸: ${item.imageSize}</div>
                                    <div class="card-text">大小: ${item.fileSize} KB</div>
                                </div>
                            </div>
                        </div>
                    `;

                        // 将生成的卡片 HTML 插入到 .row 容器的末尾
                        rowContainer.insertAdjacentHTML('beforeend', cardHTML);
                    });

                    // 判断是否为最后一页
                    if (itemList.length < avatarResourcePageSize) {
                        // 如果当前页的数据量少于每页的大小，说明是最后一页
                        alert("催催站长更新更多៷>ᴗ<៷")
                    } else {
                        // 不是最后一页，增加当前页码以请求下一页
                        avatarResourceCurrent += 1;
                    }
                } else {
                    alert(response.data);
                }
            }
        };

        get.send();
    }
    let bgResourceCurrent=1;
    let bgResourcePageSize=18;

    function listBg(searchInput) {
        let searchInputUrl = "";
        if (searchInput !== null) {
            searchInputUrl = "&searchKey=" + searchInput;
        }

        const get = new XMLHttpRequest();

        get.open("GET", "/base/anakki/record/bg-resource?current=" + bgResourceCurrent + "&size=" + bgResourcePageSize + searchInputUrl, true);
        get.setRequestHeader('authorization', localStorage.getItem('user-token'));

        get.onreadystatechange = function () {
            if (get.readyState === 4 && get.status === 200) {
                const response = JSON.parse(get.responseText);
                if (response.code === 200) {
                    const itemList = response.data.data;

                    document.getElementById("bg-tab-button-text").innerText = "桌面背景(" + response.data.totalNum + ")";

                    // 找到 .row 容器
                    const rowContainer = document.getElementById('bg-area');
                    let interval = 100;

                    // 遍历 itemList，将每个头像生成相应的 HTML
                    itemList.forEach(item => {
                        interval += 100;
                        const cardHTML = `
                        <div class="col-sm-6 col-md-3 col-lg-2 mb-4 div-trans-${interval}">
                            <div class="card avatar-card" id="img-container-${item.id}">
                                <img id="img${item.id}" onclick="showModal(this.alt)" src="${item.imgUrl}" class="card-img-top" alt="${item.id}">
                                <div class="image-float-info">
                                    <div class="img-avatar-icon">
                                        <i class="bi bi-eye" style="font-size: 1rem;">${item.viewCount}</i>
                                    </div>
                                    <div class="img-avatar-icon">
                                        <i class="bi bi-suit-heart" style="font-size: 1rem;">${item.likeCount}</i>
                                    </div>
                                </div>
                                <div class="avatar-card-body" style="font-size: 0.7rem;">
                                    <div class="card-text">尺寸: ${item.imageSize}</div>
                                    <div class="card-text">大小: ${item.fileSize} KB</div>
                                </div>
                            </div>
                        </div>
                    `;

                        // 将生成的卡片 HTML 插入到 .row 容器的末尾
                        rowContainer.insertAdjacentHTML('beforeend', cardHTML);
                    });

                    // 判断是否为最后一页
                    if (itemList.length < bgResourcePageSize) {
                        // 如果当前页的数据量少于每页的大小，说明是最后一页
                        alert("催催站长更新更多៷>ᴗ<៷")
                    } else {
                        // 不是最后一页，增加当前页码以请求下一页
                        bgResourceCurrent += 1;
                    }
                } else {
                    alert(response.data);
                }
            }
        };

        get.send();
    }

    let viewerInstance = null;
    function showModal(imgId) {
        // 创建加载动画元素
        const loadingOverlay = document.createElement("div");
        loadingOverlay.className = "loading-overlay";
        loadingOverlay.innerHTML = `<div class="loading-spinner"></div>`;
        document.body.appendChild(loadingOverlay);

        const xhr = new XMLHttpRequest();
        xhr.open("GET", "/base/anakki/record/flowById?id=" + imgId, true);
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    // 移除加载动画
                    document.body.removeChild(loadingOverlay);

                    const item = JSON.parse(xhr.responseText).data;
                    const imgUrl = item.imgUrl; // 确保你的接口返回数据中包含图片的URL
                    if (item.tag === "video") {
                        const modal = document.createElement("div");
                        modal.className = "modal-spacex";
                        modal.innerHTML = `
                                    <div class="modal-content-my">
                                        <div class="modal-header-my" onclick="this.parentElement.parentElement.remove()">
                                            <i class="bi bi-x-lg"></i>
                                        </div>
                                        <video controls>
                                            <source src="${item.imgUrl}" type="video/mp4">
                                            您的浏览器不支持播放该视频。
                                        </video>
                                        <div class="heart-icons">
                                            <div class="heart-icon" onclick="like(${item.id})">
                                                <div class="justify-content-lg-between" style="display: flex">
                                                 <i class="bi bi-suit-heart"></i>
                                                <div class="likeCount_${item.id}">${item.likeCount}</div>
                                            </div>
                                        </div>
                                    </div>
                                `;
                        document.body.appendChild(modal);
                    }else{
                        // 获取图片元素
                        const imgElement = document.getElementById("img"+imgId);

                        // 设置图片 src 属性
                        imgElement.src = imgUrl;

                        // 如果已有 Viewer 实例，则销毁
                        if (viewerInstance){
                            viewerInstance.destroy();
                        }
                        // 获取现有图片容器元素
                        const existingContainer = document.getElementById("img-container-"+imgId);
                        if (existingContainer) {
                            // 初始化 Viewer.js
                            viewerInstance = new Viewer(existingContainer, {
                                zoomable: true,
                                rotatable: true,
                                scalable: true,
                                transition: false,
                                toolbar: {
                                    zoomIn: true,
                                    zoomOut: true,
                                    oneToOne: true,
                                    reset: true,
                                    rotateLeft: true,
                                    rotateRight: true,
                                    flipHorizontal: false,
                                    flipVertical: false,
                                    close: true
                                }
                            });
                        }
                        viewerInstance.view(0)
                    }

                } else {
                    // 移除加载动画
                    document.body.removeChild(loadingOverlay);

                    // 处理错误
                    alert('加载失败，请稍后再试。');
                }
            }
        };
        xhr.send();
    }

    function initPage(currentPage, pageSize, totalPages, searchInputUrl) {
        const paginationContainer = document.getElementById("page-module");
        let html = "";
        // Previous page button
        if (currentPage > 1) {
            let number = currentPage - 1;
            html += `<li class="page-item"><a class="page-link changePageBtn" href="#" onclick="list(${number}, '${pageSize}','${searchInputUrl}')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-left" viewBox="0 0 16 16">
                          <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
                        </svg>
                    </a></li>`;
        } else {
            html += `<li class="page-item disabled">
                        <a class="page-link changePageBtn" href="#">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-left" viewBox="0 0 16 16">
                              <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
                            </svg>
                        </a>
                    </li>`;
        }
        // Page numbers
        for (let i = 1; i <= totalPages; i++) {
            if (i === currentPage) {
                html += `<li class="page-item active"><a class="page-link" href="#">${i}</a></li>`;
            } else {
                html += `<li class="page-item"><a class="page-link" href="#" onclick="list(${i}, '${pageSize}','${searchInputUrl}')">${i}</a></li>`;
            }
        }
        // Next page button
        if (currentPage < totalPages) {
            let number = currentPage + 1;
            html += `<li class="page-item"><a class="page-link changePageBtn" href="#" onclick="list(${number}, '${pageSize}','${searchInputUrl}')">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-right" viewBox="0 0 16 16">
                              <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
                            </svg>
                    </li>`;
        } else {
            html += `<li class="page-item disabled">
                        <a class="page-link changePageBtn" href="#">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-right" viewBox="0 0 16 16">
                              <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
                            </svg>
                        </a>
                    </li>`;
        }
        paginationContainer.innerHTML = html;
    }

    function checkFileSize() {
        var input = document.getElementById('file-1');
        if (input.files.length > 0) {
            var fileSize = input.files[0].size; // size in bytes
            var maxSize = 1024 * 1024 * 1024; // 1GB in bytes
            if (fileSize > maxSize) {
                alert('文件大小超过1GB，请选择小于1GB的文件进行上传。');
                return false; // Prevent form submission
            }
        }
    }

    function downloadResource(id) {
        const get = new XMLHttpRequest();
        get.open("GET", "/api/anakki/resource/download?key=" + id, true);
        get.onreadystatechange = function () {
            if (get.readyState === 4 && get.status === 200) {
                const response = JSON.parse(get.responseText);
                if (101 === response.code) {
                    alert(response.data)
                } else {
                    const downloadUrl = response.data;
                    window.open(downloadUrl);
                }
            }
        };
        get.setRequestHeader('authorization', localStorage.getItem('user-token'));
        get.send();
    }

    function deleteResource(id) {
        if (null == localStorage.getItem('user-token')) {
            alert("请登录");
            return; // 防止进一步执行
        }
        var isConfirmed = confirm("确定要删除这个资源吗？");
        if (!isConfirmed) {
            return; // If the user clicks "Cancel", stop the function
        }
        // 创建JSON对象包含资源ID
        const data = JSON.stringify({"id": id});

        const xhr = new XMLHttpRequest();
        xhr.open("POST", "/api/anakki/resource/remove", true);

        // 设置请求头以发送JSON数据
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.setRequestHeader('Authorization', localStorage.getItem('user-token'));
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                const response = JSON.parse(xhr.responseText);
                if (101 === response.code) {
                    alert(response.data)
                } else {
                    list(1, 10)
                }
            }
        };
        // 发送包含ID的JSON数据
        xhr.send(data);
    }

    function closeResource(id) {
        if (null == localStorage.getItem('user-token')) {
            alert("请登录");
            return; // 防止进一步执行
        }
        const isConfirmed = confirm("确定仅自己可见？");
        if (!isConfirmed) {
            return; // If the user clicks "Cancel", stop the function
        }
        // 创建JSON对象包含资源ID
        const data = JSON.stringify({"id": id});

        const xhr = new XMLHttpRequest();
        xhr.open("POST", "/api/anakki/resource/close", true);

        // 设置请求头以发送JSON数据
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.setRequestHeader('Authorization', localStorage.getItem('user-token'));
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                const response = JSON.parse(xhr.responseText);
                if (101 === response.code) {
                    alert(response.data)
                } else {
                    location.reload();
                }
            }
        };
        // 发送包含ID的JSON数据
        xhr.send(data);
    }

    function openResource(id) {
        if (null == localStorage.getItem('user-token')) {
            alert("请登录");
            return; // 防止进一步执行
        }
        const isConfirmed = confirm("确定要公开这个资源吗？");
        if (!isConfirmed) {
            return; // If the user clicks "Cancel", stop the function
        }
        // 创建JSON对象包含资源ID
        const data = JSON.stringify({"id": id});

        const xhr = new XMLHttpRequest();
        xhr.open("POST", "/api/anakki/resource/open", true);

        // 设置请求头以发送JSON数据
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.setRequestHeader('Authorization', localStorage.getItem('user-token'));
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                const response = JSON.parse(xhr.responseText);
                if (101 === response.code) {
                    alert(response.data)
                } else {
                    location.reload();
                }
            }
        };
        // 发送包含ID的JSON数据
        xhr.send(data);
    }
</script>
</body>
</html>